<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>çœŸ 3D ç«‹é«”åœ–å½¢æ•™å­¸ç³»çµ±</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://unpkg.com/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    
    <style>
        :root {
            --primary: #4f46e5;
            --secondary: #0ea5e9;
            --accent: #f59e0b;
            --bg: #0f172a;
            --panel-bg: rgba(255, 255, 255, 0.95);
            --text: #1e293b;
        }

        body { margin: 0; overflow: hidden; font-family: 'Segoe UI', Roboto, sans-serif; background: var(--bg); }
        
        /* UI Layer */
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; display: flex; flex-direction: column; }
        
        /* Header */
        header { pointer-events: auto; padding: 15px; background: var(--panel-bg); display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .logo-area { display: flex; align-items: center; gap: 10px; font-weight: bold; font-size: 1.1rem; color: var(--text); }
        .mode-switch { display: flex; background: #e2e8f0; border-radius: 8px; padding: 4px; }
        .mode-btn { border: none; background: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-weight: 600; color: #64748b; transition: 0.2s; }
        .mode-btn.active { background: white; color: var(--primary); shadow: 0 1px 2px rgba(0,0,0,0.1); }

        /* Shape Controls (Bottom) */
        .controls-bar { pointer-events: auto; margin-top: auto; padding: 15px; background: var(--panel-bg); overflow-x: auto; white-space: nowrap; display: flex; gap: 10px; justify-content: center; box-shadow: 0 -4px 6px rgba(0,0,0,0.1); }
        .shape-btn { padding: 8px 16px; border: 1px solid #cbd5e1; border-radius: 20px; background: white; cursor: pointer; transition: 0.2s; font-size: 0.9rem; }
        .shape-btn:hover { background: #f1f5f9; }
        .shape-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

        /* Game Overlay */
        #game-overlay { pointer-events: auto; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 20; }
        #game-overlay.active { display: flex; }
        
        .quiz-card { background: white; width: 90%; max-width: 400px; padding: 30px; border-radius: 20px; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
        .score-board { font-size: 1.2rem; margin-bottom: 20px; color: var(--secondary); font-weight: bold; }
        .quiz-icon { font-size: 5rem; display: block; margin: 20px 0; animation: float 3s ease-in-out infinite; }
        .quiz-question { font-size: 1.5rem; color: var(--text); margin-bottom: 30px; font-weight: bold; }
        
        .options-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
        .option-btn { padding: 15px 5px; border: 2px solid #e2e8f0; border-radius: 12px; background: white; cursor: pointer; font-weight: bold; transition: 0.2s; display: flex; flex-direction: column; align-items: center; }
        .option-btn:active { transform: scale(0.95); }
        .option-btn.correct { background: #dcfce7; border-color: #22c55e; color: #15803d; }
        .option-btn.wrong { background: #fee2e2; border-color: #ef4444; color: #b91c1c; }

        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-10px); } 100% { transform: translateY(0px); } }
        
        /* Floating Info Box for 3D Mode */
        .info-box { pointer-events: none; position: absolute; top: 80px; left: 20px; background: rgba(255,255,255,0.9); padding: 15px; border-radius: 12px; max-width: 250px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); transition: 0.3s; opacity: 1; }
        .info-box.hidden { opacity: 0; }
        .info-title { font-size: 1.2rem; font-weight: bold; color: var(--primary); margin-bottom: 5px; }
        .info-desc { font-size: 0.9rem; color: #475569; line-height: 1.4; }

        /* Lang Switch */
        .lang-btn { position: absolute; top: 80px; right: 20px; pointer-events: auto; background: rgba(0,0,0,0.5); color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; }

    </style>
</head>
<body>

    <div id="canvas-container" style="width: 100%; height: 100vh; display: block;"></div>

    <div id="ui-layer">
        <header>
            <div class="logo-area">
                <span style="font-size: 1.5rem;">ğŸ§Š</span>
                <span data-i18n="app_title">ç«‹é«”åœ–å½¢å¯¦é©—å®¤</span>
            </div>
            <div class="mode-switch">
                <button class="mode-btn active" onclick="setMode('explore')" data-i18n="mode_explore">è§€å¯Ÿæ¨¡å¼</button>
                <button class="mode-btn" onclick="setMode('game')" data-i18n="mode_challenge">æŒ‘æˆ°æ¨¡å¼</button>
            </div>
        </header>

        <button class="lang-btn" onclick="toggleLang()">EN / ä¸­æ–‡</button>

        <div class="info-box" id="infoBox">
            <div class="info-title" id="infoTitle">æ­£æ–¹é«”</div>
            <div class="info-desc" id="infoDesc">æœ‰ 6 å€‹å¹³çš„é¢ï¼Œæ¯å€‹é¢éƒ½æ˜¯æ­£æ–¹å½¢ã€‚</div>
        </div>

        <div class="controls-bar" id="controlsBar">
            <button class="shape-btn active" onclick="loadShape('cube')" data-i18n="s_cube">æ­£æ–¹é«”</button>
            <button class="shape-btn" onclick="loadShape('cylinder')" data-i18n="s_cylinder">åœ“æŸ±é«”</button>
            <button class="shape-btn" onclick="loadShape('cone')" data-i18n="s_cone">åœ“éŒé«”</button>
            <button class="shape-btn" onclick="loadShape('sphere')" data-i18n="s_sphere">çƒé«”</button>
            <button class="shape-btn" onclick="loadShape('tri_prism')" data-i18n="s_triprism">ä¸‰è§’æŸ±</button>
            <button class="shape-btn" onclick="loadShape('sq_pyramid')" data-i18n="s_sqpyramid">å››è§’éŒ</button>
        </div>
    </div>

    <div id="game-overlay">
        <div class="quiz-card">
            <div class="score-board"><span data-i18n="score">å¾—åˆ†</span>: <span id="scoreVal">0</span> | ğŸ”¥ <span id="streakVal">0</span></div>
            <span class="quiz-icon" id="qIcon">ğŸ“¦</span>
            <div class="quiz-question" id="qText">ç´™ç®±</div>
            
            <div class="options-grid">
                <button class="option-btn" onclick="answer('prism')">
                    <span style="font-size: 1.5rem;">ğŸ§Š</span>
                    <span data-i18n="cat_prism">æŸ±é«”</span>
                </button>
                <button class="option-btn" onclick="answer('pyramid')">
                    <span style="font-size: 1.5rem;">â›º</span>
                    <span data-i18n="cat_pyramid">éŒé«”</span>
                </button>
                <button class="option-btn" onclick="answer('sphere')">
                    <span style="font-size: 1.5rem;">âš½</span>
                    <span data-i18n="cat_sphere">çƒé«”</span>
                </button>
            </div>
            <p id="feedback" style="margin-top: 15px; height: 20px; font-weight: bold;"></p>
        </div>
    </div>

    <script>
        // --- 1. å¤šèªè¨€è¨­å®š ---
        const i18n = {
            'zh-HK': {
                app_title: "ç«‹é«”åœ–å½¢å¯¦é©—å®¤", mode_explore: "è§€å¯Ÿ", mode_challenge: "æŒ‘æˆ°",
                s_cube: "æ­£æ–¹é«”", s_cylinder: "åœ“æŸ±é«”", s_cone: "åœ“éŒé«”", s_sphere: "çƒé«”", s_triprism: "ä¸‰è§’æŸ±", s_sqpyramid: "å››è§’éŒ",
                cat_prism: "æŸ±é«”", cat_pyramid: "éŒé«”", cat_sphere: "çƒé«”",
                score: "å¾—åˆ†",
                // èªªæ˜
                d_cube: "å±¬æ–¼æŸ±é«”ã€‚æœ‰ 6 å€‹æ­£æ–¹å½¢çš„é¢ï¼Œ12 æ¢é‚Šï¼Œ8 å€‹é ‚é»ã€‚",
                d_cylinder: "å±¬æ–¼æŸ±é«”ã€‚ä¸Šä¸‹å…©å€‹é¢æ˜¯åœ“å½¢ã€‚å´é¢æ˜¯æ›²é¢ã€‚æ²’æœ‰é ‚é»ã€‚",
                d_cone: "å±¬æ–¼éŒé«”ã€‚åº•éƒ¨æ˜¯åœ“å½¢ï¼Œå´é¢ç¸®å°åˆ°ä¸€å€‹å°–é ‚ã€‚",
                d_sphere: "çƒé«”ã€‚å®Œç¾åœ“æ»‘ï¼Œæ²’æœ‰å¹³çš„é¢ï¼Œæ²’æœ‰é ‚é»ï¼Œæ²’æœ‰é‚Šã€‚",
                d_triprism: "å±¬æ–¼æŸ±é«”ã€‚åº•é¢æ˜¯ä¸‰è§’å½¢ã€‚å´é¢æ˜¯é•·æ–¹å½¢ã€‚",
                d_sqpyramid: "å±¬æ–¼éŒé«”ã€‚åº•éƒ¨æ˜¯æ­£æ–¹å½¢ã€‚å´é¢æ˜¯ä¸‰è§’å½¢ã€‚",
                // é¡Œç›®
                q_box: "å¿«éç´™ç®±", q_can: "æ±½æ°´ç½", q_ball: "ç±ƒçƒ", q_cone: "é›ªç³•ç­’", q_tent: "éœ²ç‡Ÿå¸³ç¯·", q_globe: "åœ°çƒå„€", q_book: "åšæ›¸æœ¬", q_dice: "éª°å­", q_pyramid: "åŸƒåŠé‡‘å­—å¡”", q_pipe: "æ°´ç®¡"
            },
            'en': {
                app_title: "3D Shape Lab", mode_explore: "View", mode_challenge: "Quiz",
                s_cube: "Cube", s_cylinder: "Cylinder", s_cone: "Cone", s_sphere: "Sphere", s_triprism: "Tri-Prism", s_sqpyramid: "Sq. Pyramid",
                cat_prism: "Prism", cat_pyramid: "Pyramid", cat_sphere: "Sphere",
                score: "Score",
                // Desc
                d_cube: "A Prism. Has 6 square faces, 12 edges, 8 vertices.",
                d_cylinder: "A Prism family. Top/bottom are circles. Curved side.",
                d_cone: "A Pyramid family. Circular base tapering to a vertex.",
                d_sphere: "A Sphere. Perfectly round. No flat faces, edges, or vertices.",
                d_triprism: "A Prism. Triangular bases. Rectangular sides.",
                d_sqpyramid: "A Pyramid. Square base. Triangular sides.",
                // Quiz
                q_box: "Cardboard Box", q_can: "Soda Can", q_ball: "Basketball", q_cone: "Ice Cream Cone", q_tent: "Camping Tent", q_globe: "Globe", q_book: "Thick Book", q_dice: "Dice", q_pyramid: "Great Pyramid", q_pipe: "Water Pipe"
            }
        };
        let lang = 'zh-HK';

        // --- 2. THREE.JS 3D å¼•æ“è¨­å®š ---
        let scene, camera, renderer, controls;
        let currentMesh = null;
        let currentWireframe = null;

        function init3D() {
            // å ´æ™¯
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0f172a); // æ·±è—è‰²èƒŒæ™¯

            // ç›¸æ©Ÿ
            camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 100);
            camera.position.set(0, 2, 5);

            // æ¸²æŸ“å™¨
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.getElementById('canvas-container').appendChild(renderer.domElement);

            // ç‡ˆå…‰
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            
            const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
            dirLight.position.set(5, 5, 5);
            scene.add(dirLight);
            
            const backLight = new THREE.DirectionalLight(0xffffff, 0.3);
            backLight.position.set(-5, -5, -5);
            scene.add(backLight);

            // æ§åˆ¶å™¨ (OrbitControls)
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.autoRotate = true;
            controls.autoRotateSpeed = 2.0;

            // åˆå§‹è¼‰å…¥
            loadShape('cube');
            
            animate();
            
            window.addEventListener('resize', onWindowResize, false);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }

        // --- 3. å½¢ç‹€ç”Ÿæˆé‚è¼¯ ---
        function loadShape(type) {
            // æ¸…é™¤èˆŠç‰©ä»¶
            if (currentMesh) {
                scene.remove(currentMesh);
                scene.remove(currentWireframe);
            }

            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            document.querySelectorAll('.shape-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`button[onclick="loadShape('${type}')"]`)?.classList.add('active');

            // æ›´æ–°æ–‡å­—è³‡è¨Š
            updateInfo(type);

            let geometry;
            // æè³ªï¼šåŠé€æ˜è—è‰²
            const material = new THREE.MeshPhongMaterial({ 
                color: 0x4f46e5, 
                shininess: 100,
                transparent: true,
                opacity: 0.9,
                flatShading: false
            });

            switch (type) {
                case 'cube':
                    geometry = new THREE.BoxGeometry(2, 2, 2);
                    break;
                case 'cylinder':
                    geometry = new THREE.CylinderGeometry(1, 1, 2.5, 32);
                    break;
                case 'cone':
                    geometry = new THREE.ConeGeometry(1.2, 2.5, 32);
                    break;
                case 'sphere':
                    geometry = new THREE.SphereGeometry(1.3, 32, 32);
                    break;
                case 'tri_prism':
                    // åˆ©ç”¨åœ“æŸ±é«”ä½†åªæœ‰3å€‹é‚Šä¾†æ¨¡æ“¬ä¸‰è§’æŸ±
                    geometry = new THREE.CylinderGeometry(1.2, 1.2, 2.5, 3);
                    break;
                case 'sq_pyramid':
                    // åˆ©ç”¨åœ“éŒä½†åªæœ‰4å€‹é‚Šä¾†æ¨¡æ“¬å››è§’éŒ
                    geometry = new THREE.ConeGeometry(1.5, 2, 4);
                    break;
            }

            // å‰µå»ºå¯¦é«”
            currentMesh = new THREE.Mesh(geometry, material);
            
            // å‰µå»ºé‚Šæ¡† (Wireframe) - è®“å½¢ç‹€æ›´æ¸…æ¥š
            const edges = new THREE.EdgesGeometry(geometry);
            const lineMaterial = new THREE.LineBasicMaterial({ color: 0xffffff, linewidth: 2 });
            currentWireframe = new THREE.LineSegments(edges, lineMaterial);
            
            // å°‡é‚Šæ¡†åŠ åˆ°å¯¦é«”ä¸­ï¼Œè®“å®ƒå€‘ä¸€èµ·æ—‹è½‰
            currentMesh.add(currentWireframe);
            
            scene.add(currentMesh);
        }

        function updateInfo(type) {
            const titleKey = 's_' + type;
            const descKey = 'd_' + type;
            document.getElementById('infoTitle').innerText = i18n[lang][titleKey];
            document.getElementById('infoDesc').innerText = i18n[lang][descKey];
        }

        // --- 4. éŠæˆ²é‚è¼¯ ---
        const questions = [
            { id: 'q_box', icon: 'ğŸ“¦', type: 'prism' },
            { id: 'q_dice', icon: 'ğŸ²', type: 'prism' },
            { id: 'q_book', icon: 'ğŸ“˜', type: 'prism' },
            { id: 'q_can', icon: 'ğŸ¥«', type: 'prism' }, // Cylinder is prism family
            { id: 'q_pipe', icon: 'ğŸš°', type: 'prism' },
            { id: 'q_cone', icon: 'ğŸ¦', type: 'pyramid' }, // Cone is pyramid family
            { id: 'q_tent', icon: 'â›º', type: 'pyramid' },
            { id: 'q_pyramid', icon: 'ğŸ•Œ', type: 'pyramid' },
            { id: 'q_ball', icon: 'ğŸ€', type: 'sphere' },
            { id: 'q_globe', icon: 'ğŸŒ', type: 'sphere' }
        ];
        
        let score = 0;
        let streak = 0;
        let currentQ = null;

        function setMode(mode) {
            const overlay = document.getElementById('game-overlay');
            const controls = document.getElementById('controlsBar');
            const info = document.getElementById('infoBox');
            
            // UI Update
            document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
            document.querySelector(`button[onclick="setMode('${mode}')"]`).classList.add('active');

            if (mode === 'game') {
                overlay.classList.add('active');
                controls.style.display = 'none'; // éš±è—å½¢ç‹€æŒ‰éˆ•
                info.classList.add('hidden');
                nextQuestion();
            } else {
                overlay.classList.remove('active');
                controls.style.display = 'flex'; // é¡¯ç¤ºå½¢ç‹€æŒ‰éˆ•
                info.classList.remove('hidden');
            }
        }

        function nextQuestion() {
            // éš¨æ©Ÿé¸é¡Œ
            currentQ = questions[Math.floor(Math.random() * questions.length)];
            document.getElementById('qIcon').innerText = currentQ.icon;
            document.getElementById('qText').innerText = i18n[lang][currentQ.id];
            
            // é‡ç½®æŒ‰éˆ•ç‹€æ…‹
            document.querySelectorAll('.option-btn').forEach(btn => {
                btn.className = 'option-btn'; 
            });
            document.getElementById('feedback').innerText = "";
        }

        function answer(type) {
            if (!currentQ) return;
            
            const feedback = document.getElementById('feedback');
            const isCorrect = (type === currentQ.type) || 
                              (currentQ.type === 'prism' && type === 'prism') || // Simplified logic
                              (currentQ.type === 'sphere' && type === 'sphere');

            // ç‰¹æ®Šé‚è¼¯ï¼šæ•¸å­¸ä¸Šåœ“æŸ±é«”é€šå¸¸æ­¸é¡ç‚ºæŸ±é«”å®¶æ—ï¼Œåœ“éŒé«”æ­¸é¡ç‚ºéŒé«”å®¶æ—
            // é€™è£¡ç°¡åŒ–åˆ¤æ–·
            
            if (isCorrect) {
                score += 10 + (streak * 2); // é€£å‹åŠ åˆ†
                streak++;
                feedback.innerText = "âœ… ç­”å°äº†ï¼";
                feedback.style.color = "#22c55e";
                // è¦–è¦ºåé¥‹
                event.currentTarget.classList.add('correct');
                setTimeout(nextQuestion, 800);
            } else {
                streak = 0;
                feedback.innerText = "âŒ å†è©¦ä¸€æ¬¡";
                feedback.style.color = "#ef4444";
                event.currentTarget.classList.add('wrong');
            }
            
            document.getElementById('scoreVal').innerText = score;
            document.getElementById('streakVal').innerText = streak;
        }

        function toggleLang() {
            lang = lang === 'zh-HK' ? 'en' : 'zh-HK';
            // Update UI
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (i18n[lang][key]) el.innerText = i18n[lang][key];
            });
            
            // Update dynamic text
            if (currentMesh) {
                // Find current shape type
                const activeBtn = document.querySelector('.shape-btn.active');
                if (activeBtn) {
                    const type = activeBtn.getAttribute('onclick').match(/'([^']+)'/)[1];
                    updateInfo(type);
                }
            }
            if (currentQ) {
                document.getElementById('qText').innerText = i18n[lang][currentQ.id];
            }
        }

        // å•Ÿå‹•
        init3D();

    </script>
</body>
</html>
