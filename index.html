<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>3D ç«‹é«”åœ–å½¢æ¢ç´¢å¯¦é©—å®¤</title>
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --accent: #f59e0b;
            --bg: #f8fafc;
            --surface: #ffffff;
            --text-main: #1e293b;
            --text-light: #64748b;
            --border: #e2e8f0;
            --success: #10b981;
            --error: #ef4444;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); color: var(--text-main); height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

        /* Header */
        header { background: var(--surface); padding: 0.8rem 1.2rem; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; z-index: 50; }
        .brand { display: flex; align-items: center; gap: 10px; font-weight: 700; font-size: 1.1rem; color: var(--text-main); }
        .logo { width: 32px; height: 32px; background: #ddd; border-radius: 6px; object-fit: cover; }
        .btn-sm { padding: 4px 12px; border: 1px solid var(--primary); color: var(--primary); border-radius: 20px; background: transparent; font-size: 0.8rem; cursor: pointer; transition: 0.2s; }
        .btn-sm:active { background: var(--primary); color: white; }

        /* Navigation */
        .nav-tabs { display: flex; background: var(--surface); border-bottom: 1px solid var(--border); }
        .nav-item { flex: 1; text-align: center; padding: 12px; font-weight: 600; color: var(--text-light); cursor: pointer; border-bottom: 3px solid transparent; transition: 0.2s; }
        .nav-item.active { color: var(--primary); border-bottom-color: var(--primary); }

        /* Main Layout */
        main { flex: 1; position: relative; overflow: hidden; }
        .view-section { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: none; overflow-y: auto; }
        .view-section.active { display: flex; flex-direction: column; }

        /* --- EXPLORE VIEW (3D) --- */
        .explore-layout { display: flex; flex-direction: column; height: 100%; }
        
        /* Shape Selector Bar */
        .shape-selector { padding: 10px; background: var(--surface); white-space: nowrap; overflow-x: auto; border-bottom: 1px solid var(--border); display: flex; gap: 8px; }
        .shape-btn { padding: 6px 12px; border: 1px solid var(--border); border-radius: 6px; background: var(--bg); color: var(--text-light); font-size: 0.9rem; cursor: pointer; flex-shrink: 0; }
        .shape-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

        /* 3D Stage */
        .stage-container { flex: 1; background: radial-gradient(circle at center, #f1f5f9 0%, #cbd5e1 100%); display: flex; justify-content: center; align-items: center; position: relative; overflow: hidden; cursor: grab; }
        .stage-container:active { cursor: grabbing; }
        
        .instruction-overlay { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); background: rgba(255,255,255,0.8); padding: 5px 15px; border-radius: 20px; font-size: 0.8rem; color: var(--text-light); pointer-events: none; backdrop-filter: blur(4px); }

        /* CSS 3D Engine */
        .scene { width: 200px; height: 200px; perspective: 1000px; }
        .object-3d { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; transform: rotateX(-20deg) rotateY(30deg); transition: transform 0.1s linear; }
        
        /* Generic Face Styles */
        .face { position: absolute; opacity: 0.8; border: 1px solid rgba(255,255,255,0.5); display: flex; justify-content: center; align-items: center; backface-visibility: visible; }
        .prism-face { background: rgba(37, 99, 235, 0.4); border-color: rgba(37, 99, 235, 1); }
        .pyramid-face { background: rgba(245, 158, 11, 0.4); border-color: rgba(245, 158, 11, 1); }
        
        /* 1. Cube */
        .cube .face { width: 100px; height: 100px; left: 50px; top: 50px; }
        .cube .f-front { transform: translateZ(50px); }
        .cube .f-back { transform: rotateY(180deg) translateZ(50px); }
        .cube .f-right { transform: rotateY(90deg) translateZ(50px); }
        .cube .f-left { transform: rotateY(-90deg) translateZ(50px); }
        .cube .f-top { transform: rotateX(90deg) translateZ(50px); }
        .cube .f-bottom { transform: rotateX(-90deg) translateZ(50px); }

        /* 2. Triangular Prism */
        .tri-prism .face-side { width: 100px; height: 150px; left: 50px; top: 25px; position: absolute; background: rgba(37, 99, 235, 0.4); border: 1px solid var(--primary); }
        .tri-prism .face-tri { width: 0; height: 0; border-left: 50px solid transparent; border-right: 50px solid transparent; border-bottom: 86.6px solid rgba(37, 99, 235, 0.4); left: 50px; position: absolute; }
        
        .tri-prism .s1 { transform: translateZ(28.8px); }
        .tri-prism .s2 { transform: rotateY(120deg) translateZ(28.8px); }
        .tri-prism .s3 { transform: rotateY(240deg) translateZ(28.8px); }
        .tri-prism .t-top { transform: rotateX(90deg) translateZ(75px); }
        .tri-prism .t-bottom { transform: rotateX(-90deg) translateZ(75px); }

        /* 3. Cylinder (Approximated by 12 sides) */
        .cylinder .side { position: absolute; width: 26px; height: 150px; left: 87px; top: 25px; background: rgba(37, 99, 235, 0.4); border: 1px solid rgba(37,99,235,0.3); }
        .cylinder .lid { position: absolute; width: 100px; height: 100px; border-radius: 50%; background: rgba(37, 99, 235, 0.4); left: 50px; border: 1px solid var(--primary); }
        .cylinder .lid-top { transform: rotateX(90deg) translateZ(75px); }
        .cylinder .lid-bottom { transform: rotateX(-90deg) translateZ(75px); }

        /* 4. Square Pyramid */
        .sq-pyramid .base { width: 100px; height: 100px; background: rgba(245, 158, 11, 0.6); left: 50px; top: 50px; transform: rotateX(90deg) translateZ(50px); position: absolute; border: 1px solid var(--accent); }
        .sq-pyramid .tri { width: 0; height: 0; border-left: 50px solid transparent; border-right: 50px solid transparent; border-bottom: 100px solid rgba(245, 158, 11, 0.4); position: absolute; left: 50px; top: 0; transform-origin: 50% 100%; }
        .sq-pyramid .t1 { transform: translateZ(50px) rotateX(30deg); }
        .sq-pyramid .t2 { transform: rotateY(90deg) translateZ(50px) rotateX(30deg); }
        .sq-pyramid .t3 { transform: rotateY(180deg) translateZ(50px) rotateX(30deg); }
        .sq-pyramid .t4 { transform: rotateY(-90deg) translateZ(50px) rotateX(30deg); }

        /* 5. Cone */
        .cone .cone-base { width: 100px; height: 100px; border-radius: 50%; background: rgba(245, 158, 11, 0.6); left: 50px; top: 50px; transform: rotateX(90deg) translateZ(50px); position: absolute; border: 1px solid var(--accent); }
        .cone .cone-side { width: 0; height: 0; border-left: 20px solid transparent; border-right: 20px solid transparent; border-bottom: 100px solid rgba(245, 158, 11, 0.4); position: absolute; left: 80px; top: 0; transform-origin: 50% 100%; }

        /* 6. Sphere (Wireframe) */
        .sphere-container { position: relative; width: 140px; height: 140px; left: 30px; top: 30px; transform-style: preserve-3d; animation: spin 10s linear infinite; }
        .ring { position: absolute; width: 100%; height: 100%; border: 2px solid rgba(239, 68, 68, 0.6); border-radius: 50%; }
        .ring:nth-child(1) { transform: rotateY(0deg); }
        .ring:nth-child(2) { transform: rotateY(60deg); }
        .ring:nth-child(3) { transform: rotateY(120deg); }
        .ring:nth-child(4) { transform: rotateX(90deg); border-color: rgba(239, 68, 68, 0.8); border-width: 3px; } /* Equator */

        /* Info Panel */
        .info-panel { padding: 20px; background: var(--surface); border-top: 1px solid var(--border); min-height: 150px; }
        .info-title { font-size: 1.2rem; margin-bottom: 5px; color: var(--text-main); }
        .info-desc { font-size: 0.95rem; color: var(--text-light); line-height: 1.5; }
        .info-badges { display: flex; gap: 10px; margin-top: 10px; }
        .badge { padding: 4px 10px; border-radius: 4px; font-size: 0.8rem; font-weight: bold; }
        .badge-prism { background: #dbeafe; color: #1e40af; }
        .badge-pyramid { background: #fef3c7; color: #92400e; }
        .badge-sphere { background: #fee2e2; color: #991b1b; }


        /* --- GAME VIEW --- */
        .game-layout { padding: 20px; max-width: 600px; margin: 0 auto; width: 100%; }
        .stats-bar { display: flex; justify-content: space-between; margin-bottom: 20px; background: var(--surface); padding: 10px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .score-box { font-weight: bold; color: var(--primary); }
        
        .question-area { background: var(--surface); border-radius: 12px; padding: 20px; text-align: center; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .q-item { font-size: 4rem; margin: 20px 0; display: block; }
        .q-text { font-size: 1.1rem; margin-bottom: 20px; color: var(--text-main); }
        
        .drop-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
        .drop-target { background: white; border: 2px dashed #cbd5e1; border-radius: 8px; padding: 15px 5px; text-align: center; cursor: pointer; transition: 0.2s; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100px; }
        .drop-target:active, .drop-target.hover { border-color: var(--primary); background: #eff6ff; }
        .drop-target h4 { font-size: 0.9rem; margin-top: 5px; pointer-events: none; }
        .drop-icon { font-size: 1.5rem; pointer-events: none; }

        .feedback-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; z-index: 100; }
        .modal-content { background: white; padding: 30px; border-radius: 12px; text-align: center; width: 80%; max-width: 300px; animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        /* Utilities */
        .hidden { display: none !important; }
        
    </style>
</head>
<body>

    <header>
        <div class="brand">
            <img src="logo.png" class="logo" alt="Logo" onerror="this.style.display='none'">
            <span data-i18n="app_title">3D å½¢ç‹€å¯¦é©—å®¤</span>
        </div>
        <button class="btn-sm" id="langBtn">EN / ä¸­æ–‡</button>
    </header>

    <nav class="nav-tabs">
        <div class="nav-item active" onclick="switchTab('explore')" data-i18n="tab_explore">æ¢ç´¢æ¨¡å¼</div>
        <div class="nav-item" onclick="switchTab('game')" data-i18n="tab_game">æŒ‘æˆ°åˆ†é¡</div>
    </nav>

    <main>
        <div id="section-explore" class="view-section active">
            <div class="explore-layout">
                <div class="shape-selector">
                    <button class="shape-btn active" onclick="setShape('cube')" data-i18n="s_cube">æ­£æ–¹é«”</button>
                    <button class="shape-btn" onclick="setShape('cylinder')" data-i18n="s_cylinder">åœ“æŸ±é«”</button>
                    <button class="shape-btn" onclick="setShape('tri-prism')" data-i18n="s_triprism">ä¸‰è§’æŸ±</button>
                    <button class="shape-btn" onclick="setShape('sq-pyramid')" data-i18n="s_sqpyramid">å››è§’éŒ</button>
                    <button class="shape-btn" onclick="setShape('cone')" data-i18n="s_cone">åœ“éŒé«”</button>
                    <button class="shape-btn" onclick="setShape('sphere')" data-i18n="s_sphere">çƒé«”</button>
                </div>

                <div class="stage-container" id="stage">
                    <div class="scene">
                        <div class="object-3d" id="model3d">
                            </div>
                    </div>
                    <div class="instruction-overlay" data-i18n="drag_hint">ğŸ‘† æ‹–æ›³æ—‹è½‰ / Drag to Rotate</div>
                </div>

                <div class="info-panel">
                    <h2 class="info-title" id="infoTitle">æ­£æ–¹é«” (Cube)</h2>
                    <div class="info-badges" id="infoBadges"></div>
                    <p class="info-desc" id="infoDesc">æ‰€æœ‰é¢éƒ½æ˜¯æ­£æ–¹å½¢ï¼Œè€Œä¸”å¤§å°ç›¸åŒã€‚</p>
                </div>
            </div>
        </div>

        <div id="section-game" class="view-section">
            <div class="game-layout">
                <div class="stats-bar">
                    <span data-i18n="score">å¾—åˆ†:</span> <span id="scoreVal" class="score-box">0</span>
                </div>

                <div class="question-area">
                    <span class="q-item" id="qIcon">ğŸ“¦</span>
                    <h3 class="q-text" id="qName">å¿«éç´™ç®±</h3>
                    <p style="font-size: 0.8rem; color:#999;" data-i18n="game_instruction">é€™æ˜¯å“ªä¸€é¡åœ–å½¢ï¼Ÿé»æ“Šä¸‹æ–¹ç­”æ¡ˆã€‚</p>
                </div>

                <div class="drop-grid">
                    <div class="drop-target" onclick="checkAnswer('prism')">
                        <span class="drop-icon">ğŸ§Š</span>
                        <h4 data-i18n="cat_prism">æŸ±é«”</h4>
                    </div>
                    <div class="drop-target" onclick="checkAnswer('pyramid')">
                        <span class="drop-icon">â›º</span>
                        <h4 data-i18n="cat_pyramid">éŒé«”</h4>
                    </div>
                    <div class="drop-target" onclick="checkAnswer('sphere')">
                        <span class="drop-icon">âš½</span>
                        <h4 data-i18n="cat_sphere">çƒé«”</h4>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div class="feedback-modal" id="feedbackModal">
        <div class="modal-content">
            <h2 id="fbTitle">Correct!</h2>
            <p id="fbMsg" style="margin: 10px 0;">Good Job</p>
            <button class="btn-sm" style="background:var(--primary); color:white; padding: 8px 20px;" onclick="closeModal()" data-i18n="next_q">ä¸‹ä¸€é¡Œ</button>
        </div>
    </div>

    <script>
        // --- DATA & CONFIG ---
        const langData = {
            'zh-HK': {
                app_title: "3D å½¢ç‹€å¯¦é©—å®¤", tab_explore: "æ¢ç´¢", tab_game: "æŒ‘æˆ°",
                s_cube: "æ­£æ–¹é«”", s_cylinder: "åœ“æŸ±é«”", s_triprism: "ä¸‰è§’æŸ±", s_sqpyramid: "å››è§’éŒ", s_cone: "åœ“éŒé«”", s_sphere: "çƒé«”",
                drag_hint: "ğŸ‘† æ‹–æ›³ç•«é¢æ—‹è½‰",
                cat_prism: "æŸ±é«”", cat_pyramid: "éŒé«”", cat_sphere: "çƒé«”",
                score: "å¾—åˆ†:", game_instruction: "é»æ“Šä¸‹æ–¹æ­£ç¢ºçš„åˆ†é¡", next_q: "ä¸‹ä¸€é¡Œ",
                correct: "ç­”å°äº†ï¼", wrong: "å†è©¦ä¸€æ¬¡ï¼",
                // Descriptions
                d_cube: "å±¬æ–¼æŸ±é«”ã€‚æœ‰ 6 å€‹å¹³çš„é¢ï¼Œæ¯å€‹é¢éƒ½æ˜¯æ­£æ–¹å½¢ã€‚",
                d_cylinder: "å±¬æ–¼æŸ±é«”ã€‚ä¸Šä¸‹å…©å€‹é¢æ˜¯åœ“å½¢ï¼Œä¸”å¤§å°ç›¸åŒã€‚å´é¢æ˜¯æ›²é¢ã€‚",
                d_triprism: "å±¬æ–¼æŸ±é«”ã€‚ä¸Šä¸‹åº•é¢æ˜¯ä¸‰è§’å½¢ã€‚å´é¢æ˜¯é•·æ–¹å½¢ã€‚",
                d_sqpyramid: "å±¬æ–¼éŒé«”ã€‚åº•éƒ¨æ˜¯æ­£æ–¹å½¢ï¼Œæœ‰ 4 å€‹ä¸‰è§’å½¢å´é¢èšç„¦æ–¼é ‚é»ã€‚",
                d_cone: "å±¬æ–¼éŒé«”ã€‚åº•éƒ¨æ˜¯åœ“å½¢ï¼Œå´é¢æ˜¯æ›²é¢ï¼Œç¸®å°åˆ°ä¸€å€‹å°–é ‚ã€‚",
                d_sphere: "çƒé«”ã€‚å¾ä¸­å¿ƒåˆ°è¡¨é¢ä»»ä½•ä¸€é»çš„è·é›¢éƒ½ç›¸ç­‰ã€‚æ²’æœ‰å¹³çš„é¢ã€‚",
                // Game Items
                i_box: "ç´™ç®±", i_can: "æ±½æ°´ç½", i_tent: "å¸³ç¯·", i_ball: "ç±ƒçƒ", i_orange: "æ©™", i_icecream: "é›ªç³•ç­’", i_book: "æ›¸æœ¬", i_battery: "é›»æ± "
            },
            'en': {
                app_title: "3D Shape Lab", tab_explore: "Explore", tab_game: "Challenge",
                s_cube: "Cube", s_cylinder: "Cylinder", s_triprism: "Tri-Prism", s_sqpyramid: "Sq. Pyramid", s_cone: "Cone", s_sphere: "Sphere",
                drag_hint: "ğŸ‘† Drag to Rotate",
                cat_prism: "Prism", cat_pyramid: "Pyramid", cat_sphere: "Sphere",
                score: "Score:", game_instruction: "Tap the correct category below", next_q: "Next",
                correct: "Correct!", wrong: "Try Again!",
                // Descriptions
                d_cube: "A Prism. Has 6 flat faces, all are squares.",
                d_cylinder: "A Prism family. Top and bottom are congruent circles. Has a curved side.",
                d_triprism: "A Prism. Bases are triangles. Side faces are rectangles.",
                d_sqpyramid: "A Pyramid. Base is a square. 4 triangular faces meet at the apex.",
                d_cone: "A Pyramid family. Base is a circle. Tapers smoothly to a point.",
                d_sphere: "A Sphere. Every point on the surface is the same distance from the center.",
                // Game Items
                i_box: "Box", i_can: "Soda Can", i_tent: "Tent", i_ball: "Basketball", i_orange: "Orange", i_icecream: "Ice Cream Cone", i_book: "Book", i_battery: "Battery"
            }
        };

        const shapeConfigs = {
            'cube': { 
                type: 'prism', 
                html: `<div class="cube"><div class="face f-front prism-face"></div><div class="face f-back prism-face"></div><div class="face f-right prism-face"></div><div class="face f-left prism-face"></div><div class="face f-top prism-face"></div><div class="face f-bottom prism-face"></div></div>` 
            },
            'tri-prism': {
                type: 'prism',
                html: `<div class="tri-prism"><div class="face-tri t-top"></div><div class="face-tri t-bottom"></div><div class="face-side s1"></div><div class="face-side s2"></div><div class="face-side s3"></div></div>`
            },
            'cylinder': {
                type: 'prism',
                // Generating 12 sides for cylinder approximation
                html: (() => {
                    let s = '<div class="cylinder"><div class="lid lid-top"></div><div class="lid lid-bottom"></div>';
                    for(let i=0; i<12; i++) {
                        s += `<div class="side" style="transform: rotateY(${i*30}deg) translateZ(48px);"></div>`;
                    }
                    s += '</div>';
                    return s;
                })()
            },
            'sq-pyramid': {
                type: 'pyramid',
                html: `<div class="sq-pyramid"><div class="base"></div><div class="tri t1 pyramid-face"></div><div class="tri t2 pyramid-face"></div><div class="tri t3 pyramid-face"></div><div class="tri t4 pyramid-face"></div></div>`
            },
            'cone': {
                type: 'pyramid',
                // Approximating cone with 16 thin triangles
                html: (() => {
                    let s = '<div class="cone"><div class="cone-base"></div>';
                    for(let i=0; i<16; i++) {
                        s += `<div class="cone-side" style="transform: rotateY(${i*(360/16)}deg) translateZ(10px) rotateX(15deg);"></div>`;
                    }
                    s += '</div>';
                    return s;
                })()
            },
            'sphere': {
                type: 'sphere',
                html: `<div class="sphere-container"><div class="ring"></div><div class="ring"></div><div class="ring"></div><div class="ring"></div></div>`
            }
        };

        const quizItems = [
            { id: 'i_box', icon: 'ğŸ“¦', type: 'prism' },
            { id: 'i_can', icon: 'ğŸ¥«', type: 'prism' },
            { id: 'i_book', icon: 'ğŸ“˜', type: 'prism' },
            { id: 'i_battery', icon: 'ğŸ”‹', type: 'prism' },
            { id: 'i_tent', icon: 'â›º', type: 'pyramid' },
            { id: 'i_icecream', icon: 'ğŸ¦', type: 'pyramid' },
            { id: 'i_ball', icon: 'ğŸ€', type: 'sphere' },
            { id: 'i_orange', icon: 'ğŸŠ', type: 'sphere' }
        ];

        let currentLang = 'zh-HK';
        let currentRotation = { x: -20, y: 30 };
        let score = 0;
        let currentQuizItem = null;

        // --- INIT & EVENTS ---
        document.addEventListener('DOMContentLoaded', () => {
            updateLang();
            setShape('cube');
            initDragControl();
            nextQuestion();
        });

        document.getElementById('langBtn').addEventListener('click', () => {
            currentLang = currentLang === 'zh-HK' ? 'en' : 'zh-HK';
            updateLang();
            // Refresh info text for current shape
            const currentShapeBtn = document.querySelector('.shape-btn.active');
            if(currentShapeBtn) {
                const shapeKey = currentShapeBtn.getAttribute('onclick').match(/'([^']+)'/)[1];
                updateInfoText(shapeKey);
            }
            // Refresh Quiz text
            if(currentQuizItem) {
                document.getElementById('qName').innerText = langData[currentLang][currentQuizItem.id];
            }
        });

        // --- CORE FUNCTIONS ---

        function updateLang() {
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if(langData[currentLang][key]) el.innerText = langData[currentLang][key];
            });
        }

        function switchTab(tab) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.getElementById('section-'+tab).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            event.target.classList.add('active');
        }

        function setShape(key) {
            // Update UI Buttons
            document.querySelectorAll('.shape-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active'); // Note: this relies on event bubbling if called from onclick
            
            // Render 3D
            const container = document.getElementById('model3d');
            container.innerHTML = shapeConfigs[key].html;
            
            // Reset Rotation
            currentRotation = { x: -20, y: 30 };
            applyRotation();

            updateInfoText(key);
        }

        function updateInfoText(key) {
            const config = shapeConfigs[key];
            const titleKey = 's_' + key.replace('-',''); // simple mapping
            const descKey = 'd_' + key.replace('-','');
            
            document.getElementById('infoTitle').innerText = langData[currentLang][titleKey] || langData[currentLang]['s_'+key];
            document.getElementById('infoDesc').innerText = langData[currentLang][descKey];
            
            const badge = document.getElementById('infoBadges');
            const typeLabel = langData[currentLang]['cat_' + config.type];
            badge.innerHTML = `<span class="badge badge-${config.type}">${typeLabel}</span>`;
        }

        // --- 3D ROTATION LOGIC (MOUSE/TOUCH) ---
        function initDragControl() {
            const stage = document.getElementById('stage');
            let isDragging = false;
            let startX, startY;

            const startDrag = (e) => {
                isDragging = true;
                startX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
                startY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;
            };

            const doDrag = (e) => {
                if (!isDragging) return;
                e.preventDefault();
                const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
                const clientY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;
                
                const deltaX = clientX - startX;
                const deltaY = clientY - startY;

                currentRotation.y += deltaX * 0.5;
                currentRotation.x -= deltaY * 0.5; // Invert Y axis for natural feel

                applyRotation();
                
                startX = clientX;
                startY = clientY;
            };

            const endDrag = () => { isDragging = false; };

            stage.addEventListener('mousedown', startDrag);
            document.addEventListener('mousemove', doDrag);
            document.addEventListener('mouseup', endDrag);

            stage.addEventListener('touchstart', startDrag);
            document.addEventListener('touchmove', doDrag);
            document.addEventListener('touchend', endDrag);
        }

        function applyRotation() {
            const model = document.getElementById('model3d');
            model.style.transform = `rotateX(${currentRotation.x}deg) rotateY(${currentRotation.y}deg)`;
        }

        // --- GAME LOGIC ---
        function nextQuestion() {
            const randIndex = Math.floor(Math.random() * quizItems.length);
            currentQuizItem = quizItems[randIndex];
            document.getElementById('qIcon').innerText = currentQuizItem.icon;
            document.getElementById('qName').innerText = langData[currentLang][currentQuizItem.id];
        }

        function checkAnswer(userChoice) {
            const isCorrect = userChoice === currentQuizItem.type;
            const modal = document.getElementById('feedbackModal');
            const title = document.getElementById('fbTitle');
            const msg = document.getElementById('fbMsg');
            
            modal.style.display = 'flex';
            
            if(isCorrect) {
                score += 10;
                document.getElementById('scoreVal').innerText = score;
                title.innerText = langData[currentLang].correct;
                title.style.color = 'var(--success)';
                msg.innerText = "ğŸ‰ +10 Points";
            } else {
                title.innerText = langData[currentLang].wrong;
                title.style.color = 'var(--error)';
                msg.innerText = "ğŸ’ª Keep trying!";
            }
        }

        function closeModal() {
            document.getElementById('feedbackModal').style.display = 'none';
            nextQuestion();
        }

    </script>
</body>
</html>
